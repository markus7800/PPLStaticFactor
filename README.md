# Static Factorisation of Probabilistic Programs With User-Labelled Sample Statements and While Loops

Overview:
```
. 
├── evaluation/
│     ├── benchmark/                        # benchmark set of 15 probabilistic models
│     │     └── generated/                  # sub-programs generated by generate_factorisation.py script
│     ├── custom/                           # implementation of custom factorisations (GMM + LDA)
│     ├── finite/                           # implementation of fixed-finite factorisation
│     ├── unrolled/                         # programs where while loop can be syntactically unrolled
│     │     └── generated/                  # sub-programs generated by generate_factorisation.py script
│     ├── bench.jl                          # script to run benchmark for model
│     ├── paper_results/                    # runtime results reported in paper
│     └── ppl.jl                            # implemenation of research PPL
│
├── src/   
│     ├── formal/
│     │     ├── ast.jl                      # get abstract syntax tree for julia program
│     │     ├── factorisation_builder.py    # uses model_graph.py to write sub-programs for each factor of probabilistic program
│     │     └── formal_cfg.py               # computes the CFG for probabilistic program
│     └── static/
│           ├── cfg.py                      # types for building CFG
│           ├── ir.py                       # intermediate represenation of probabilstic program
│           ├── model_graph.py              # computes dependencies between sample statements as graph
│           └── rd_bp.py                    # functionality to compute reaching definitions and branch parents
├── generate_factorisation.py               # script to generate sub-programs for each factor for every model
└── run_benchmark.py                        # script to run bench.jl for every model
```

## Setup

No special hardware is needed for installation.

Recommendations:
- Hardware: >= 3.5 GHZ dual core CPU, >= 8 GB RAM, and >= 10 GB storage
- OS: unix-based operating system
- Installation with Docker

### Docker Installation

Install [docker](https://www.docker.com).

Build the pplstaticfactor image (this may take several minutes):
```
docker build -t pplstaticfactor .
```

If the build was successful, run the docker image:
```
docker run -it --name pplstaticfactor --rm pplstaticfactor
```

## Replication of Paper

Generate the sub-programs:
```
python3 generate_factorisation.py
```

Run benchmarks:
```
python3 run_benchmark.py
```
The results are written to `evaluation/results.csv`.
The results reported in the paper can be found in  `evaluation/paper_results.csv` (measure on a M2 Pro CPU).